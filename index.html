<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <div id="stats" class="ui stats">
        <div id="stats1" class="stats-item">
          <p class="stats-item-title">
            Main
          </p>
        </div>
        <div id="stats2" class="stats-item">
          <p class="stats-item-title">
            Worker
          </p>
        </div>
      </div>
    <div id="app">
        <video
       
          loop
          autoplay
          muted
          playsinline
          id="video">
        </video>
        <canvas id="canvas"></canvas>
      </div>

    <script src="https://raw.githack.com/kalwalt/jsartoolkitNFT/master/build/artoolkitNFT_wasm.js">
    
    </script>
    <script src="./stat.js"></script>
    <script src="./three.js"></script>
    <script src="./three_worker.js"></script>
    <script>
        var statsMain = new Stats();
        statsMain.showPanel( 0 ); // 0: fps, 1: ms, 2: mb, 3+: custom
        document.getElementById( 'stats1' ).appendChild( statsMain.dom );
        var statsWorker = new Stats();
        statsWorker.showPanel( 0 ); // 0: fps, 1: ms, 2: mb, 3+: custom
        document.getElementById( 'stats2' ).appendChild( statsWorker.dom );
        var container = document.getElementById( 'app' );
        var video = document.getElementById( 'video' );
        var canvas = document.getElementById( 'canvas' );
        console.log(video)
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            var hint = {
              audio: false,
              video: true
            };
            if( window.innerWidth < 800 ) {
              var width = ( window.innerWidth < window.innerHeight ) ? 240 : 360;
              var height = ( window.innerWidth < window.innerHeight ) ? 360 : 240;
        
              var aspectRatio = window.innerWidth / window.innerHeight;
        
              console.log( width, height );
        
              hint = {
                audio: false,
                video: {
                  facingMode: 'environment',
                  width: { min: width, max: width }
                },
              };
        
              console.log( hint );
            }
        
            navigator.mediaDevices.getUserMedia( hint ).then( function( stream ) {
              video.srcObject = stream;
              video.addEventListener( 'loadedmetadata', function() {
                video.play();
        
                console.log( 'video', video, video.videoWidth, video.videoHeight );
        
                start(
                  container,
                  './trex/trex-image/trex',
                  video,
                  video.videoWidth,
                  video.videoHeight,
                  canvas,
                  function() {
                   statsMain.update()
                  },
                  function() {
                    statsWorker.update();
                  }
                );
              } );
            } );
          }
    </script>
</body>
</html>